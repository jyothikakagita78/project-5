var MMTimer,__assign,__spreadArray,VideoEvents;(function(n){var t=function(){function n(n,t,i,r,u){var f,e;i===void 0&&(i=!0);r===void 0&&(r=!1);u===void 0&&(u=0);f=this;this.start=function(){this.running||(this.running=!0,this.startedDate=(new Date).getTime(),this.timer=this.useInterval?setInterval(this.callback,this.timeoutMS):setTimeout(this.callback,this.remaining))};this.pause=function(){this.timer&&this.running&&(this.useInterval||(this.running=!1,clearTimeout(this.timer),this.remaining-=(new Date).getTime()-this.startedDate))};this.getTimeLeft=function(){return this.running&&(this.pause(),this.start()),this.remaining};this.getStateRunning=function(){return this.running};this.destroy=function(){this.running=!1;this.useInterval?clearInterval(this.timer):clearTimeout(this.timer);this.remaining=-1};this.callback=n;this.remaining=t;this.timeoutMS=t;this.useInterval=r;r&&u>0&&(this.remaining=u,e=function(){f.remaining>0&&(f.remaining-=t,f.remaining>0&&n())},this.callback=e.bind(this));i===!0&&this.start()}return n}();n.Timer=t})(MMTimer||(MMTimer={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(){function ur(i){(t("started initialization",i),i&&!(i.length<2)&&i[1]&&ft&&n)&&(kt=i[1].videoType,tt=i[1].videoExtraInfo,r=i[1].bindEventSupportedList?i[1].bindEventSupportedList:r,li=i[1].skipPerVideoCI,i[1].videoEventsConfig&&vi(i[1].videoEventsConfig),!ri&&n&&(ui(),sr()),i[1].videoDuration&&at(i),tt&&wr(),et==1&&fr(),t("finished initialization"),lt(i))}function fr(){var i,r,n;typeof Multimedia!=y&&typeof((r=(i=Multimedia.Video)===null||i===void 0?void 0:i.Utils)===null||r===void 0?void 0:r.gavcaspr)==h&&(n=Multimedia.Video.Utils.gavcaspr());l=n>1?"long":n>0?"short":"na";t("aspect ratio: "+n+", videoSubType: "+l)}function er(t){t&&!(t.length<2)&&t[1]&&ft&&n&&vi(t[1])}function vi(n){var f,i,u;g.ciClearTimer&&typeof e==p&&typeof n==p&&JSON.stringify(e)==JSON.stringify(n)||(e=n,ot=!1,ci=(f=e.ci)===null||f===void 0?void 0:f.noci,i=e.ecietl,(i===null||i===void 0?void 0:i.length)&&(r=i),or(),u=e.tcic,(u===null||u===void 0?void 0:u.length)&&u.forEach(function(n){var i,t=n.inm;k[t]=n;n.ft>0&&(st[t]=n.ft);ht(n.ste,t,dt);ht(n.pte,t,gt);ht(n.cte,t,ni);ht(n.utte,t,ai);ti[t]=n.efs;ii[t]=n.dfs;!ot&&((i=n.drld)===null||i===void 0?void 0:i.indexOf(rt.videoPlayTime))>=0&&(ot=!0)}),t("Config: extra-CI",k))}function or(){var n,r,i;if(g.ciClearTimer)n=Object.keys(a),(n===null||n===void 0?void 0:n.length)&&n.forEach(function(n){var i=a[n];typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+n))});else for(r in Object.keys(a))i=a[r],typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+r));a={};k={};d={};st={};dt={};gt={};ni={};ai={};ti={};ii={}}function ht(n,t,i){(n===null||n===void 0?void 0:n.length)&&i&&n.forEach(function(n){i[n]||(i[n]=new Set);i[n].add(t)})}function yi(n){var i=ti[n],r=ii[n],u=!1,t;if(i===null||i===void 0?void 0:i.length){for(t=0;t<i.length;t++)if(pi(i[t])){u=!0;break}}else u=!0;if(r===null||r===void 0?void 0:r.length)for(t=0;t<r.length;t++)if(pi(r[t])){u=!1;break}return u}function pi(n){if(n&&typeof _d==p&&typeof _d.querySelector==h)try{return _d.querySelector(n)}catch(i){return t("invalid selector",n),!1}}function wi(n){return(n===null||n===void 0?void 0:n.size)?Array.from(n).filter(function(n){return yi(n)}):null}function sr(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&n&&(sj_evt.bind(n.EmbedPlayer_ComponentUpdate,bi),sj_evt.bind(n.EmbedPlayer_Load,lt),sj_evt.bind(n.VideoCanvas_VideoPlaying,ct),sj_evt.bind(n.VideoCanvas_VideoStopped,s),sj_evt.bind(n.VideoCanvas_VideoEnded,s),sj_evt.bind(n.VideoCanvas_VideoPlayerReady,at));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.bind(u.PlayerDownloadEndEvt,ki),sj_evt.bind(u.PlayerStartEvt,ct),sj_evt.bind(u.PlayerEndEvt,s),sj_evt.bind(u.PlayerErrEvt,s),sj_evt.bind(u.PlayerPauseEvt,s),sj_evt.bind(u.StopPlayEvt,s));ri=!0;sj_be(_w,oi,ui)}function hr(){if(typeof(o===null||o===void 0?void 0:o.destroy)==h){if(b){var n=o.getTimeLeft();t("player time left: "+n);o.pause();n>0&&!it&&n<rr&&fi(!0)}o.destroy();t("clear video IsCI timer")}ci&&!it&&f&&fi(!1);o=null;it=!1;b=!1}function bi(n){hr();lr(n);cr()}function cr(){l=null;ut=0}function lr(n){var u=vt(n),r=ni[u],i;(r===null||r===void 0?void 0:r.size)&&(i=Array.from(r),(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=a[n],e=d[n],r,f;typeof(i===null||i===void 0?void 0:i.destroy)==h&&(r=k[n],r.atdoe>0&&(f=i.getTimeLeft(),i.pause(),f>0&&!e&&f<r.atdoe&&i.fireCallback==h&&(i.fireCallback(),d[n]=!0)),i.destroy(),t("clear timer: "+n+" by event: "+u));a[n]=null;d[n]=!1}))}function ar(){if(!it){if(o)o.start();else{var n=di();t("IsCI countdown: "+n+"ms");o=new ft(pr,n)}t("startTimer")}}function ct(n){ar();lt(n)}function lt(n){var r=vt(n),i=wi(dt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(i){var u=k[i];if(u)u.uvdbs&&at(n);else return;u.ft>0||(st[i]=di());vr(i,u);t("startTimer: "+i+" by event: "+r)})}function vr(n,i){var f=i.uit,o=i.ciat,s=d[n],r,u,e;(!s||f)&&(r=a[n],r?r.start():(u=tu(n),t("IsCI countdown: "+u+"ms"),e=dr(n),a[n]=new ft(e,u,!0,f,o)))}function s(n){o===null||o===void 0?void 0:o.pause();t("pauseTimer");yr(n)}function yr(n){var r=vt(n),i=wi(gt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=a[n];i&&(i.pause(),t("pauseTimer",n,r))})}function ui(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&n&&(sj_evt.unbind(n.EmbedPlayer_ComponentUpdate,bi),sj_evt.unbind(n.VideoCanvas_VideoPlaying,ct),sj_evt.unbind(n.EmbedPlayer_Load,lt),sj_evt.unbind(n.VideoCanvas_VideoStopped,s),sj_evt.unbind(n.VideoCanvas_VideoEnded,s),sj_evt.unbind(n.VideoCanvas_VideoPlayerReady,at));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.unbind(u.PlayerDownloadEndEvt,ki),sj_evt.unbind(u.PlayerStartEvt,ct),sj_evt.unbind(u.PlayerEndEvt,s),sj_evt.unbind(u.PlayerErrEvt,s),sj_evt.unbind(u.PlayerPauseEvt,s),sj_evt.unbind(u.StopPlayEvt,s));ri=!1;sj_ue(_w,oi,ui)}function at(n){if(i=-1,n&&!(n.length<2)&&n[1]){var r=n[1];if(r.videoDuration>0&&(i=r.videoDuration*hi),et==0){switch(kt){case"video":b=i<=nt;break;case"preview":b=i<=bt}i>si?l="long":i>0&&(l="short")}t("update duration",i,l)}}function ki(n){if(i=-1,n&&!(n.length<5)&&n[4]){var t=n[4];t>0&&(i=t*hi)}}function t(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];"object"===p&&"object"===h}function vt(n){return(n===null||n===void 0?void 0:n.length)?n[0]:""}function pr(){if(li){t("Skip per video IsCI");return}fi(!0);t("IsCI")}function wr(){var n={TS:null,T:null,AppNS:tr},t={recoFeedbackType:null,videoExtraInfo:__assign({},tt)};tt&&(n=__assign(__assign({},n),tt));f={j:n,r:t}}function fi(t){var r,u,o,i=f===null||f===void 0?void 0:f.j,s=f===null||f===void 0?void 0:f.r;i&&s&&(i.T=t?"IsCI":"IsNoCI",i.TS=(new Date).getTime(),((r=e===null||e===void 0?void 0:e.ci)===null||r===void 0?void 0:r.eld)&&(i=__assign(__assign({},i),e.ci.eld)),((o=(u=e===null||e===void 0?void 0:e.ci)===null||u===void 0?void 0:u.drld)===null||o===void 0?void 0:o.length)&&e.ci.drld.indexOf(rt.videoSubType)>=0&&(i.videoSubType=l),s.recoFeedbackType=t?"IsCI":"IsNoCI",typeof pInstr!=y&&pInstr&&pInstr.icd(i),typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&n&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),sj_evt.fire(n.VideoCanvas_VideoCI,i)),it=t,(w===null||w===void 0?void 0:w.ithe())&&n&&(i.TS=null,sj_evt.fire(n===null||n===void 0?void 0:n.VideoEvent_LogInst,JSON.stringify(i),i.T)))}function br(i){var o,u=k[i],r,e,c,s;u&&yi(i)&&(r=f===null||f===void 0?void 0:f.j,r)&&(r.T=u.t,r.TS=(new Date).getTime(),e=u.ldwl,(e===null||e===void 0?void 0:e.length)&&(r=kr(r,e)),u.eld&&(r=__assign(__assign({},r),u.eld)),((o=u.drld)===null||o===void 0?void 0:o.length)&&(u.drld.indexOf(rt.videoSubType)>=0&&(r.videoSubType=l),u.drld.indexOf(rt.videoPlayTime)>=0&&ut&&!isNaN(ut)&&(r[rt.videoPlayTime]=Math.round(ut))),typeof pInstr!=y&&pInstr&&pInstr.icd(r),c=u.uit,c||(d[i]=!0),t("Sent "+(u===null||u===void 0?void 0:u.t)),u.erf&&(s=f===null||f===void 0?void 0:f.r,s&&typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&n&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),t("Sent reco feedback"))),(w===null||w===void 0?void 0:w.ithe())&&n&&(r.TS=null,sj_evt.fire(n===null||n===void 0?void 0:n.VideoEvent_LogInst,JSON.stringify(r),r.T)))}function kr(n,t){var i={},r=__spreadArray(__spreadArray([],ir,!0),t,!0);return r.forEach(function(t){n[t]!==undefined&&n[t]!==null&&(i[t]=n[t])}),i}function dr(n){return function(){br(n)}}function di(){switch(et){case 1:return gr();case 0:default:return nu()}}function gr(){if(i>0){var n=void 0;switch(l){case"short":n=Math.min(i,nt);break;case"long":default:n=Math.min(i,v)}return b=i<=n,t("CI on completing whole video: ",b),n}return v}function nu(){switch(kt){case"video":return i>si?v:i>0?Math.min(i,nt):g.defaultValueUpdate?v:nt;case"preview":return i>0?Math.min(i,bt):bt;default:return g.defaultValueUpdate?i>0?Math.min(i,v):v:Number.MAX_SAFE_INTEGER}}function tu(n){var t=st[n];return typeof t==gi?t:g.defaultValueUpdate?v:Number.MAX_SAFE_INTEGER}function iu(n){var i,t;!ot||(n===null||n===void 0?void 0:n.length)<2||(t=(i=n[1])===null||i===void 0?void 0:i.currentTime,typeof t=="number"&&t>0&&(ut=t))}var yt,pt,p="object",gi="number",y="undefined",h="function",nr="Video.CI",ei=typeof Multimedia==p&&typeof((yt=Multimedia.Video)===null||yt===void 0?void 0:yt.swte)==h?Multimedia.Video.swte:function(){return!1},g={defaultValueUpdate:ei("cidfvu"),ciClearTimer:ei("cictm")},w=typeof(Multimedia===null||Multimedia===void 0?void 0:Multimedia.MultimediaTestUtils)!=y?Multimedia.MultimediaTestUtils:null,u=typeof VRHConsts!=y?VRHConsts:null,n=typeof SharedEventString!=y?SharedEventString:null,ft=typeof MMTimer!=y?MMTimer.Timer_FixPause||MMTimer.Timer:null,oi="unload",tr="video",ir=["T","TS","AppNS"],wt=typeof vv_cm_cf==p?vv_cm_cf:null,c=(pt=wt===null||wt===void 0?void 0:wt.ist)===null||pt===void 0?void 0:pt.ci,et=c?c.vtcm:0,si=3e4,v=(c===null||c===void 0?void 0:c.lvcit)>0?c.lvcit:2e4,nt=(c===null||c===void 0?void 0:c.svcit)>0?c.svcit:8e3,bt=8e3,hi=1e3,rr=1e3,i,tt,kt,o,it=!1,b=!1,f,ci=!1,r=["preview","video"],li=!1,ot=!1,e=null,k={},a={},d={},st={},dt={},gt={},ni={},ai={},ti={},ii={},rt={videoSubType:"videoSubType",videoPlayTime:"videoPlayTime"},l,ri=!1,ut;n&&(sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_InitIsCIModule,ur,!0),sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_UpdateVideoEventsConfig,er,!0),sj_evt.bind(n===null||n===void 0?void 0:n.VideoPlayer_InfoUpdate,iu,!0));t("Configurable CI loaded");t("global config",c);t("video type calc method: "+et);t("long video CI timeout: "+v+", short video CI timeout: "+nt)}(VideoEvents||(VideoEvents={}))